<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Graviton - World-class scientific simulation platform with 256 interactive physics, math, and AI simulations">
    <meta property="og:title" content="Graviton App - Scientific Simulations">
    <meta property="og:description" content="Real-time physics, biology, and AI simulations in your browser">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://app.graviton.dev">
    <meta name="twitter:card" content="summary_large_image">
    <title>Graviton | Scientific Simulations</title>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --accent: #60a5fa;
            --accent-dim: #1e3a5f;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
        }
        * { box-sizing: border-box; }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg-primary);
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            color: var(--text-primary);
        }
        #canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--accent);
            font-size: 1.5rem;
            text-align: center;
            z-index: 1000;
        }
        .loading-title { font-weight: 600; margin-bottom: 8px; }
        .loading-subtitle { font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 20px; }
        .loading::after {
            content: '';
            display: block;
            width: 40px;
            height: 40px;
            margin: 20px auto;
            border: 3px solid var(--accent-dim);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Router UI */
        .router-hub {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            z-index: 100;
            overflow-y: auto;
            padding: 2rem;
        }
        .router-hub.active { display: block; }
        .router-header {
            max-width: 1200px;
            margin: 0 auto 2rem;
            text-align: center;
        }
        .router-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), #a78bfa);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0 0 0.5rem;
        }
        .router-header p { color: var(--text-secondary); margin: 0; }
        .dimension-section {
            max-width: 1200px;
            margin: 0 auto 2rem;
        }
        .dimension-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--accent-dim);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .dimension-badge {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 4px;
            background: var(--accent-dim);
            color: var(--accent);
        }
        .sim-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }
        .sim-card {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-dim);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: inherit;
        }
        .sim-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(96, 165, 250, 0.15);
        }
        .sim-card.demo { border-color: #22c55e; }
        .sim-card.demo:hover { box-shadow: 0 8px 24px rgba(34, 197, 94, 0.2); }
        .sim-card h3 {
            margin: 0 0 0.25rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .sim-card .status {
            font-size: 0.625rem;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: 600;
        }
        .status.demo { background: #22c55e; color: #000; }
        .status.active { background: var(--accent); color: #000; }
        .status.planned { background: var(--accent-dim); color: var(--text-secondary); }
        .sim-card .title-cn { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .sim-card p { margin: 0; font-size: 0.875rem; color: var(--text-secondary); }
        .sim-url { 
            font-family: monospace; 
            font-size: 0.75rem; 
            color: var(--accent); 
            margin-top: 0.75rem;
            opacity: 0.7;
        }
    </style>
    <link data-trunk rel="rust" data-wasm-opt="z" />
    <link data-trunk rel="copy-file" href="simulations.json" />
</head>
<body>
    <div class="router-hub" id="routerHub"></div>
    <div class="loading" id="loading">
        <div class="loading-title">Loading Graviton</div>
        <div class="loading-subtitle" id="loadingSubtitle">Initializing simulation engine...</div>
    </div>
    <canvas id="canvas"></canvas>
    
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Graviton Router - Dynamic simulation routing for 256 cartridges
        // URL Schema: /sim/[dimension]/[cartridge-id]
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const GRAVITON_ROUTER = {
            config: null,
            
            async init() {
                // Parse current route
                const path = window.location.pathname;
                const params = new URLSearchParams(window.location.search);
                
                // Load simulation config
                try {
                    const resp = await fetch('/simulations.json');
                    this.config = await resp.json();
                } catch (e) {
                    console.warn('Could not load simulations.json, using embedded config');
                    this.config = { dimensions: {}, simulations: {} };
                }
                
                // Route matching
                const simMatch = path.match(/^\/sim\/([a-z]+)\/([a-z0-9-]+)\/?$/);
                
                if (path === '/' || path === '') {
                    // Show hub
                    this.showHub();
                } else if (simMatch) {
                    // Load specific simulation
                    const [, dimension, simId] = simMatch;
                    this.loadSimulation(dimension, simId, params);
                } else {
                    // Unknown route - show hub
                    this.showHub();
                }
            },
            
            showHub() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('canvas').style.display = 'none';
                const hub = document.getElementById('routerHub');
                hub.classList.add('active');
                hub.innerHTML = this.renderHub();
            },
            
            renderHub() {
                const dims = this.config.dimensions;
                const sims = this.config.simulations;
                
                // Group simulations by dimension
                const grouped = {};
                for (const [id, sim] of Object.entries(sims)) {
                    if (!grouped[sim.dimension]) grouped[sim.dimension] = [];
                    grouped[sim.dimension].push({ id, ...sim });
                }
                
                let html = `
                    <div class="router-header">
                        <h1>âš›ï¸ Graviton Simulations</h1>
                        <p>256 Interactive Physics, Math & AI Simulations</p>
                    </div>
                `;
                
                const dimOrder = ['tensor', 'logic', 'genesis', 'neural', 'axiom'];
                const dimIcons = { logic: 'ğŸ”Œ', tensor: 'ğŸŒŠ', genesis: 'ğŸ§¬', neural: 'ğŸ§ ', axiom: 'âˆ' };
                
                for (const dimKey of dimOrder) {
                    const dim = dims[dimKey];
                    const simList = grouped[dimKey] || [];
                    if (!dim || simList.length === 0) continue;
                    
                    html += `
                        <div class="dimension-section">
                            <div class="dimension-title">
                                <span>${dimIcons[dimKey] || 'ğŸ“¦'}</span>
                                <span>${dim.name_en}</span>
                                <span class="dimension-badge">${dim.name}</span>
                            </div>
                            <div class="sim-grid">
                    `;
                    
                    for (const sim of simList) {
                        const url = `/sim/${dimKey}/${sim.id}`;
                        const statusClass = sim.status || 'planned';
                        html += `
                            <a href="${url}" class="sim-card ${statusClass}">
                                <h3>
                                    ${sim.title_en}
                                    <span class="status ${statusClass}">${statusClass}</span>
                                </h3>
                                <div class="title-cn">${sim.title}</div>
                                <p>${sim.description}</p>
                                <div class="sim-url">${url}</div>
                            </a>
                        `;
                    }
                    
                    html += '</div></div>';
                }
                
                return html;
            },
            
            loadSimulation(dimension, simId, params) {
                const sim = this.config.simulations[simId];
                const subtitle = document.getElementById('loadingSubtitle');
                
                if (sim) {
                    document.title = `${sim.title_en} - Graviton`;
                    subtitle.textContent = `Loading ${sim.title_en}...`;
                    
                    // Update meta tags for sharing
                    const ogTitle = document.querySelector('meta[property="og:title"]');
                    if (ogTitle) ogTitle.content = `${sim.title_en} - Graviton`;
                } else {
                    subtitle.textContent = `Loading ${simId}...`;
                }
                
                // Store route info for WASM to read
                window.GRAVITON_ROUTE = {
                    dimension,
                    simId,
                    debug: params.get('debug') === 'true',
                    template: params.get('template')
                };
                
                console.log(`[Graviton Router] Loading: /sim/${dimension}/${simId}`);
                
                // Continue with WASM load - canvas stays visible
                document.getElementById('routerHub').classList.remove('active');
            }
        };
        
        // Initialize router
        document.addEventListener('DOMContentLoaded', () => GRAVITON_ROUTER.init());
        
        // Hide loading after WASM loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 100);
        });
    </script>
</body>
</html>
